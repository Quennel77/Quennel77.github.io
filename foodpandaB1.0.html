<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>å ±é…¬è¨ˆç®—</title>
<style>
/* === åŸºæœ¬æ¨£å¼ === */
body{
  font-family: Arial, sans-serif;
  margin: 6;
  padding-top: env(safe-area-inset-top, 0px);
  background: #121212;
  color: #eee;
}
.container{width:90%;max-width:500px;margin:auto;background:#1e1e1e;padding:0px;border-radius:22px;box-shadow:0 4px 10px rgba(0,0,0,0.5);box-sizing:border-box;}
h2{display:flex;justify-content:space-between;align-items:center;color:#eee;}
label{display:block;margin-top:10px;font-weight:bold;color:#eee;}
.input-group{display:flex;margin:2px 0;}
input{width:calc(100% - 50px);padding:10px;font-size:16px;background:#2a2a2a;color:#eee;border:1px solid #555;border-radius:6px;}
.inc-btn,.dec-btn,.reset-btn{width:60px;height:60px;font-size:26px;margin-left:5px;border:none;border-radius:8px;background:#ff69b4;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .2s,background .2s;}
.inc-btn:hover,.dec-btn:hover,.reset-btn:hover{background:#005fa3;transform:rotate(20deg);}
.result{margin-top:15px;font-size:28px;text-align:center;font-weight:bold;}
#amount{width:200px;font-size:30px;padding:2px 4px;text-align:center;background:#2a2a2a;border:1px solid #555;color:#fc1212;}
#formula{margin-top:15px;font-size:16px;color:#eee;line-height:1.5;white-space:pre-line;text-align:center;}
#oldFormula,#secondHint{margin-top:2px;font-size:15px;color:#ccc;line-height:1.4;white-space:normal;text-align:center;}
#errorMsg{color:red;margin-bottom:10px;font-weight:bold;}
.sub-result{font-size:16px!important;}
.sub-result #secondAmount{width:80px!important;font-size:18px!important;padding:2px 4px!important;}
body,button{touch-action:manipulation;-webkit-user-select:none;-webkit-tap-highlight-color:transparent;}
input{touch-action:auto;-webkit-user-select:text;}
input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0;}
input[type=number]{-moz-appearance:textfield;}
button,.calc-btn,.reset-btn{transition:none !é‡è¦;transform:none!important;}
button:active,.calc-btn:active,.reset-btn:active{transform:none!important;scale:1!important;}
.order-block{max-width:300px;margin:20px auto;font-size:16px;font-family:Arial,sans-serif;color:#eee;}
.order-block input{background:#2a2a2a;color:#eee;border:1px solid #555;}
.order-block span{color:#ccc;}
.order-block button{background:#0078d7;color:#fff;}
#yVal,#xVal{padding:4px 6px;height:28px;font-size:20px;}
.inc-btn,.dec-btn{width:60px;height:38px;font-size:22px!important;line-height:1!important;margin-left:4px;border-radius:6px;border:none;background:#ff69b4;color:#fff;cursor:pointer;}
#base25,#extraFee,#base25secondHint,#extraFeesecondHint{font-size:15px;margin-top:4px;text-align:center;}
#base25,#base25secondHint{color:#f2c2c2;}
#extraFee,#extraFeesecondHint{color:#ccc;}
@media (max-width:375px){
  .inc-btn,.dec-btn,.reset-btn{width:38px;height:38px;font-size:20px;}
  #amount{font-size:32px;width:130px;}
  #formula,#oldFormula,#secondHint{font-size:14px;}
}

/* === â­¥ é–‹å•ŸæŒ‘é¸å™¨çš„æŒ‰éˆ• === */
.picker-btn{
  width:50px;
  height:38px;
  margin-left:4px;
  margin-right:0px;
  border:1px solid #555;
  border-radius:6px;
  background:#2a2a2a;
  color:#eee;
  font-size:20px;
  cursor:pointer;
  transform:scale(0.64);
  transform-origin:right center;
  padding:0;
}

/* ========================= å–®æ¬„æŒ‘é¸å™¨ ========================= */
.picker-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:9999;}
.picker{width:min(92vw,420px);max-height:72vh;background:#1f1f1f;border:1px solid #444;border-radius:14px;box-shadow:0 12px 40px rgba(0,0,0,.6);display:flex;flex-direction:column;overflow:hidden;}
.picker-header{padding:12px 16px;font-size:16px;color:#eee;border-bottom:1px solid #333;text-align:center;}
.picker-wheel{position:relative;height:260px;overflow-y:auto;scrollbar-width:thin;overscroll-behavior:contain;-webkit-overflow-scrolling:touch;}
.picker-list{margin:0;padding:8px 0;list-style:none;}
.picker-item{height:46px;display:flex;align-items:center;justify-content:center;font-size:20px;color:#ccc;user-select:none;cursor:pointer;}
.picker-item:hover{background:#2a2a2a;}
.picker-item.active{color:#fff;font-weight:800;background:rgba(255,255,255,.08);outline:1px solid rgba(255,255,255,.22);}
.picker-actions{display:flex;gap:10px;padding:12px;border-top:1px solid #333;}
.picker-actions button{flex:1;height:40px;border-radius:8px;border:1px solid #555;background:#2a2a2a;color:#eee;font-size:16px;cursor:pointer;}
.picker-actions .confirm{background:#0a84ff;border-color:#0a84ff;color:#fff;}

/* ======== å¤šæ¬„æ•¸ä½æ»‘è¼ªï¼ˆå€ç‡ & å…¬é‡Œï¼‰ ======== */
.dial-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.55);
  display:none;align-items:center;justify-content:center;
  z-index:10000;overscroll-behavior:contain;
  touch-action:none; /* é®ç½©ä¸æ¥æ‰‹åŸç”Ÿæ‰‹å‹¢ï¼Œé¿å…é–æ­» */
}
.dial{width:min(92vw,540px);background:#1f1f1f;border:1px solid #444;border-radius:14px;box-shadow:0 12px 40px rgba(0,0,0,.6);overflow:hidden;}
.dial-header{padding:12px 16px;font-size:16px;color:#eee;border-bottom:1px solid #333;text-align:center;}
.digit-wrap{position:relative;display:grid;grid-template-columns:1fr 16px 1fr 1fr;gap:10px;padding:18px 20px 14px;align-items:center;}
.dot{ text-align:center;color:#ccc;font-size:26px;user-select:none; }
.wheel{
  position:relative;height:220px;overflow-y:auto;overscroll-behavior:contain;scrollbar-width:thin;
  background:#1c1c1c;border:1px solid #333;border-radius:10px;scroll-snap-type:y mandatory;
  -webkit-overflow-scrolling:touch;
  touch-action:auto;           /* ä½¿ç”¨åŸç”Ÿæ…£æ€§æ»¾å‹• */
  will-change:scroll-position;
}
.wheel::-webkit-scrollbar{width:6px}
.wheel::-webkit-scrollbar-thumb{background:#444;border-radius:6px}
.digit{height:48px;display:flex;align-items:center;justify-content:center;font-size:26px;color:#eee;scroll-snap-align:center;user-select:none;}
.highlight{position:absolute;left:0;right:0;top:50%;transform:translateY(-50%);height:48px;pointer-events:none;border-top:1px solid rgba(255,255,255,.25);border-bottom:1px solid rgba(255,255,255,.25);}
.spacer{height:72px;}
.dial-actions{display:flex;gap:10px;padding:12px;border-top:1px solid #333;}
.dial-actions button{flex:1;height:40px;border-radius:8px;border:1px solid #555;background:#2a2a2a;color:#eee;font-size:16px;cursor:pointer;}
.dial-actions .confirm{background:#0a84ff;border-color:#0a84ff;color:#fff;}
.digit.center{ font-weight:800; font-size:30px; color:#fff; }
/* è®“æœªé¸ä¸­çš„é …ç›®æ›´å°æ›´æ·¡ï¼›ç›¸é„°çš„ç¨å¾®çªå‡ºï¼›ä¸­é–“æœ€æ˜é¡¯ */
.wheel .digit{
  font-size: 26px;
  opacity: 0.35;
  transform: scale(0.86);
  transition: transform .18s ease, opacity .18s ease, font-size .18s ease;
}

/* ä¸­å¿ƒç›¸é„°ï¼ˆÂ±1æ ¼ï¼‰ */
.wheel .digit.near{
  font-size: 24px;
  opacity: 0.65;
  transform: scale(0.94);
}

/* å…¶å®ƒæ›´é çš„ï¼ˆÂ±2æ ¼ä»¥ä¸Šï¼‰ */
.wheel .digit.far{
  font-size: 20px;
  opacity: 0.30;
  transform: scale(0.84);
}

/* ä¸­å¿ƒé‚£ä¸€æ ¼ï¼ˆè¢«é¸ä¸­ï¼‰ */
.wheel .digit.center{
  font-size: 32px;
  font-weight: 800;
  opacity: 1;
  color: #fff;
}

/* === é¿å…æ‰‹æ©Ÿä¸Š + / âˆ’ è¢«æ“ åˆ°æœ€å³é‚Š === */
.input-group { gap: 8px; align-items: center; }
.input-group > * { flex: 0 0 auto; }
.input-group input { flex: 1 1 0; width: auto !important; min-width: 0; }
.picker-btn { margin-right: 10px; transform: scale(0.62); transform-origin: right center; }
.input-group .inc-btn { margin-left: 6px !important; }
.input-group .inc-btn,.input-group .dec-btn,.picker-btn { flex-shrink: 0; }

@media (max-width: 480px) {
  .input-group { gap: 8px; }
  .input-group .inc-btn,.input-group .dec-btn { width: 44px; height: 38px; font-size: 20px !important; margin-left: 6px !important; }
  .picker-btn { margin-right: 8px; transform: scale(0.58); }
  .container { padding-left: 8px; padding-right: 8px; }
}
@media (max-width: 360px) {
  .input-group { gap: 6px; }
  .picker-btn { margin-right: 6px; transform: scale(0.56); }
  .input-group .inc-btn,.input-group .dec-btn { width: 40px; }
}
</style>
</head>

<body>
<div class="container">
  <h2>
    å ±é…¬è¨ˆç®—
    <button class="reset-btn" onclick="resetValues()">ğŸ”„</button>
  </h2>

  <label>ç•¶æ™‚å€ç‡ï¼š</label>
  <div class="input-group">
    <input type="number" id="yVal" value="1.40" step="0.01" oninput="calc()">
    <button class="picker-btn" id="openYPicker" aria-label="é¸æ“‡å€ç‡">â­¥</button>
    <button class="inc-btn">+</button>
    <button class="dec-btn">-</button>
  </div>
  
  <label>ç¸½å…¬é‡Œæ•¸ï¼š</label>
  <div class="input-group">
    <input type="number" id="xVal" value="2.50" step="0.10" oninput="calc()">
    <button class="picker-btn" id="openXPicker" aria-label="é¸æ“‡å…¬é‡Œæ•¸">â­¥</button>
    <button class="inc-btn">+</button>
    <button class="dec-btn">-</button>
  </div>

  <div id="errorMsg"></div>

  <div class="result">
    <input type="number" id="amount" value="" step="0.01" placeholder="è¼¸å…¥é‡‘é¡" /> å…ƒ
    <div id="base25"></div>
    <div id="extraFee"></div>
    <div id="secondHint"></div>
    <div class="sub-result">
      <span class="second-text">ç–Šå–®ï¼š</span>
      <input type="number" id="secondAmount" value="" step="0.01" placeholder="è¼¸å…¥é‡‘é¡" 
        style="width:90px; font-size:18px; text-align:center; background:#2a2a2a; color:#fc1212; border:1px solid #555; border-radius:6px;"> å…ƒ
    </div>
    <div id="base25secondHint"></div>
    <div id="extraFeesecondHint"></div>
    <div id="oldFormula"></div>
  </div>
</div>

<!-- === å–®æ¬„æŒ‘é¸å™¨ï¼šå…¬é‡Œæ•¸ === -->
<div class="picker-overlay" id="xPickerOverlay" role="dialog" aria-modal="true" aria-labelledby="xPickerTitle">
  <div class="picker">
    <div class="picker-header" id="xPickerTitle">é¸æ“‡å…¬é‡Œæ•¸ï¼š<span id="xPickerNow" style="color:#0a84ff;font-weight:700;">â€”</span></div>
    <div class="picker-wheel" id="xPickerWheel"><ul class="picker-list" id="xPickerList"></ul></div>
    <div class="picker-actions">
      <button type="button" class="cancel" id="xPickerCancel">å–æ¶ˆ</button>
      <button type="button" class="confirm" id="xPickerConfirm">ç¢ºèª</button>
    </div>
  </div>
</div>

<!-- === å–®æ¬„æŒ‘é¸å™¨ï¼šå€ç‡ === -->
<div class="picker-overlay" id="yPickerOverlay" role="dialog" aria-modal="true" aria-labelledby="yPickerTitle">
  <div class="picker">
    <div class="picker-header" id="yPickerTitle">é¸æ“‡å€ç‡ï¼š<span id="yPickerNow" style="color:#0a84ff;font-weight:700;">â€”</span></div>
    <div class="picker-wheel" id="yPickerWheel"><ul class="picker-list" id="yPickerList"></ul></div>
    <div class="picker-actions">
      <button type="button" class="cancel" id="yPickerCancel">å–æ¶ˆ</button>
      <button type="button" class="confirm" id="yPickerConfirm">ç¢ºèª</button>
    </div>
  </div>
</div>

<!-- === å¤šæ¬„ï¼šå€ç‡ 3 æ ¼ === -->
<div class="dial-overlay" id="yDialOverlay" role="dialog" aria-modal="true" aria-labelledby="yDialTitle">
  <div class="dial">
    <div class="dial-header" id="yDialTitle">é¸æ“‡å€ç‡ï¼š<span id="yDialNow" style="color:#0a84ff;font-weight:700;">â€”</span> Ã—</div>
    <div class="digit-wrap">
      <div class="wheel" id="dialInt"></div>
      <div class="dot">.</div>
      <div class="wheel" id="dialD1"></div>
      <div class="wheel" id="dialD2"></div>
      <div class="highlight"></div>
    </div>
    <div class="dial-actions">
      <button type="button" id="yDialCancel">å–æ¶ˆ</button>
      <button type="button" class="confirm" id="yDialConfirm">ç¢ºèª</button>
    </div>
  </div>
</div>

<!-- === å¤šæ¬„ï¼šå…¬é‡Œ 4 æ ¼ï¼ˆè‡³ 99.99ï¼‰ === -->
<div class="dial-overlay" id="xDialOverlay" role="dialog" aria-modal="true" aria-labelledby="xDialTitle">
  <div class="dial">
    <div class="dial-header" id="xDialTitle">é¸æ“‡å…¬é‡Œæ•¸ï¼š<span id="xDialNow" style="color:#0a84ff;font-weight:700;">â€”</span> km</div>
    <div class="digit-wrap" style="grid-template-columns:1fr 1fr 16px 1fr 1fr;">
      <div class="wheel" id="xDialIntTens"></div>
      <div class="wheel" id="xDialIntOnes"></div>
      <div class="dot">.</div>
      <div class="wheel" id="xDialDec1"></div>
      <div class="wheel" id="xDialDec2"></div>
      <div class="highlight"></div>
    </div>
    <div class="dial-actions">
      <button type="button" id="xDialCancel">å–æ¶ˆ</button>
      <button type="button" class="confirm" id="xDialConfirm">ç¢ºèª</button>
    </div>
  </div>
</div>

<script>
/* ===== è¨ˆç®—é‚è¼¯ï¼ˆæœªå‹•ï¼‰ ===== */
const DEFAULT_X=2.50, DEFAULT_Y=1.40, SECOND_FLOOR=30; let KM_FEE=11.50;
function change(id,delta){const input=document.getElementById(id);let value=parseFloat(input.value)||0;if(id==="xVal"){value+=delta;if(value<2.50)value=2.50;}else{value+=delta;if(value<0)value=0;}input.value=value.toFixed(2);calc();}
function showError(msg){document.getElementById('errorMsg').innerText=msg||'';}
function calc(){
  const x=parseFloat(document.getElementById('xVal').value);
  const y=parseFloat(document.getElementById('yVal').value);
  const amountInput=document.getElementById('amount');
  if(isNaN(x)||isNaN(y)){showError('');return;} else {showError('');}
  const baseFirst=(10+10+5+5)*y;
  const distancePart=Math.max(0,(x-2.50))*KM_FEE*y;
  const first=baseFirst+distancePart;
  const baseSecondRaw=(10+5+5)*y;
  const baseSecond25=Math.max(SECOND_FLOOR,baseSecondRaw);
  const distanceSecondFee=distancePart;
  const second=baseSecond25+distanceSecondFee;
  if(!(document.activeElement&&document.activeElement.id==='amount')) amountInput.value=first.toFixed(2);
  const base25=(10+10+5+5)*y, distanceFee=distancePart;
  document.getElementById('base25').innerText=`ç›®å‰å–®åƒ¹ï¼š ${base25.toFixed(2)} å…ƒ`;
  document.getElementById('extraFee').innerText=`å¤šå‡ºé‡Œç¨‹è²»ç”¨ï¼š ${distanceFee.toFixed(2)} å…ƒ`;
  const secondInput=document.getElementById('secondAmount');
  const activeId=document.activeElement?document.activeElement.id:"";
  if(activeId!=='secondAmount') secondInput.value=second.toFixed(2);
  document.getElementById('base25secondHint').innerText=`ç›®å‰ç–Šå–®å–®åƒ¹ï¼š ${baseSecond25.toFixed(2)} å…ƒ`;
  document.getElementById('extraFeesecondHint').innerText=`å¤šå‡ºç–Šå–®é‡Œç¨‹è²»ç”¨ï¼š ${distanceSecondFee.toFixed(2)} å…ƒ`;
  const oldResultRush=(40+((x-2.5)*15)+2).toFixed(2);
  const diffRush=(first-oldResultRush).toFixed(2);
  document.getElementById('oldFormula').innerHTML=`èˆŠåˆ¶ç®—æ³•ï¼šé¤æœŸ 40+2 + ${(x-2.5).toFixed(2)}Ã—15 = <span style="color:#fa6969; font-weight:bold;">${oldResultRush} å…ƒ</span><br>(å·® ${diffRush} å…ƒ)`;
}
document.getElementById('amount').addEventListener('input',function(){
  const price=parseFloat(this.value), y=parseFloat(document.getElementById('yVal').value), xInput=document.getElementById('xVal');
  if(this.value===''){showError('');return;}
  if(isNaN(price)||isNaN(y)||y===0){showError('');return;}
  const fixedPart=(10+10+5+5)*y;
  const x=((price-fixedPart)/(KM_FEE*y))+2.5;
  if(!isFinite(x)||x<2.50) return;
  xInput.value=x.toFixed(2); calc();
});
document.getElementById('secondAmount').addEventListener('input',function(){
  const price=parseFloat(this.value), y=parseFloat(document.getElementById('yVal').value), xInput=document.getElementById('xVal');
  const base=Math.max(30,(10+5+5)*y);
  if(this.value===''||isNaN(price)||isNaN(y)||y===0) return;
  const x=((price-base)/(KM_FEE*y))+2.5;
  if(!isFinite(x)||x<2.5) return;
  xInput.value=x.toFixed(2); calc();
});
function resetValues(){document.getElementById('xVal').value=DEFAULT_X.toFixed(2);document.getElementById('yVal').value=DEFAULT_Y.toFixed(2);calc();}
document.querySelectorAll('.inc-btn,.dec-btn').forEach(btn=>{
  let timer=null,interval=null;const shortStep=.1,longStep=.01,delay=400,speed=400;
  const getTargetId=b=>b.closest('.input-group').querySelector('input').id;
  const doStep=(b,step)=>{const id=getTargetId(b);const delta=b.classList.contains('inc-btn')?step:-step;change(id,delta);};
  const start=e=>{if(e.type==='mousedown'&&'ontouchstart'in window)return;e.preventDefault();timer=setTimeout(()=>{interval=setInterval(()=>doStep(btn,longStep),speed);},delay);};
  const stop=e=>{clearTimeout(timer);clearInterval(interval);if(e.type!=='mouseleave'&&!interval){doStep(btn,shortStep);}timer=interval=null;};
  btn.addEventListener('touchstart',start);btn.addEventListener('touchend',stop);btn.addEventListener('touchcancel',stop);
  btn.addEventListener('mousedown',start);btn.addEventListener('mouseup',stop);btn.addEventListener('mouseleave',stop);
});

/* ===== å–®æ¬„æŒ‘é¸å™¨ï¼ˆåŸæœ¬ï¼‰ ===== */
const MIN_X=2.50, MAX_X=15.00, STEP_X=0.01;
const xPicker={ overlay:document.getElementById('xPickerOverlay'), wheel:document.getElementById('xPickerWheel'), list:document.getElementById('xPickerList'), btnOpen:document.getElementById('openXPicker'), btnCancel:document.getElementById('xPickerCancel'), btnConfirm:document.getElementById('xPickerConfirm'), now:document.getElementById('xPickerNow'), value:DEFAULT_X };
function buildXList(){ if(xPicker.list.childElementCount>0) return; const frag=document.createDocumentFragment(); for(let v=MIN_X; v<=MAX_X+1e-9; v+=STEP_X){ const li=document.createElement('li'); li.className='picker-item'; li.dataset.value=v.toFixed(2); li.textContent=v.toFixed(2)+' km'; li.addEventListener('click', ()=>{ setActiveX(parseFloat(li.dataset.value)); li.scrollIntoView({block:'center',behavior:'smooth'}); }); frag.appendChild(li);} xPicker.list.appendChild(frag);}
function setActiveX(val){ const v=Math.min(MAX_X,Math.max(MIN_X,val)); xPicker.value=parseFloat(v.toFixed(2)); xPicker.now.textContent=xPicker.value.toFixed(2)+' km'; xPicker.list.querySelectorAll('.picker-item.active').forEach(el=>el.classList.remove('active')); const target=xPicker.list.querySelector(`.picker-item[data-value="${xPicker.value.toFixed(2)}"]`); if(target) target.classList.add('active');}
function openXPicker(){ buildXList(); const curr = parseFloat(document.getElementById('xVal').value); setActiveX(isNaN(curr) ? MIN_X : curr); xPicker.overlay.style.display = 'flex'; lockBodyScroll(); document.addEventListener('keydown', keyNavX); const target = xPicker.list.querySelector(`.picker-item[data-value="${xPicker.value.toFixed(2)}"]`); if (target) target.scrollIntoView({ block: 'center', behavior: 'auto' });}
function closeXPicker(){ xPicker.overlay.style.display='none'; document.removeEventListener('keydown', keyNavX); unlockBodyScroll(); }
function keyNavX(e){ if(xPicker.overlay.style.display!=='flex') return; if(e.key==='ArrowUp'||e.key==='ArrowDown'){ e.preventDefault(); setActiveX(xPicker.value+(e.key==='ArrowUp'?-STEP_X:STEP_X)); const t=xPicker.list.querySelector(`.picker-item[data-value="${xPicker.value.toFixed(2)}"]`); if(t) t.scrollIntoView({block:'center',behavior:'auto'}); } else if(e.key==='Enter'){ confirmXPicker(); } else if(e.key==='Escape'){ closeXPicker(); }}
function confirmXPicker(){ const input=document.getElementById('xVal'); input.value=xPicker.value.toFixed(2); closeXPicker(); calc(); }
xPicker.btnOpen.addEventListener('click', openXPicker);
xPicker.btnCancel.addEventListener('click', closeXPicker);
xPicker.btnConfirm.addEventListener('click', confirmXPicker);
xPicker.overlay.addEventListener('click', e=>{ if(e.target===xPicker.overlay) closeXPicker(); });

const MIN_Y=1.35, MAX_Y=6.99, STEP_Y=0.01;
const yPicker={ overlay:document.getElementById('yPickerOverlay'), wheel:document.getElementById('yPickerWheel'), list:document.getElementById('yPickerList'), btnOpen:document.getElementById('openYPicker'), btnCancel:document.getElementById('yPickerCancel'), btnConfirm:document.getElementById('yPickerConfirm'), now:document.getElementById('yPickerNow'), value:DEFAULT_Y };
function buildYList(){ if(yPicker.list.childElementCount>0) return; const frag=document.createDocumentFragment(); for(let v=MIN_Y; v<=MAX_Y+1e-9; v+=STEP_Y){ const fixed = v.toFixed(2); const li=document.createElement('li'); li.className='picker-item'; li.dataset.value=fixed; li.textContent=fixed+' Ã—'; li.addEventListener('click', ()=>{ setActiveY(parseFloat(li.dataset.value)); li.scrollIntoView({block:'center',behavior:'smooth'}); }); frag.appendChild(li);} yPicker.list.appendChild(frag);}
function setActiveY(val){ const v=Math.min(MAX_Y,Math.max(MIN_Y,val)); yPicker.value=parseFloat(v.toFixed(2)); yPicker.now.textContent=yPicker.value.toFixed(2)+' Ã—'; yPicker.list.querySelectorAll('.picker-item.active').forEach(el=>el.classList.remove('active')); const target=yPicker.list.querySelector(`.picker-item[data-value="${yPicker.value.toFixed(2)}"]`); if(target) target.classList.add('active');}
function openYPicker(){ buildYList(); const curr = parseFloat(document.getElementById('yVal').value); setActiveY(isNaN(curr) ? DEFAULT_Y : curr); yPicker.overlay.style.display = 'flex'; lockBodyScroll(); const target = yPicker.list.querySelector(`.picker-item[data-value="${yPicker.value.toFixed(2)}"]`); if (target) target.scrollIntoView({ block: 'center', behavior: 'auto' });}
function closeYPicker(){ yPicker.overlay.style.display='none'; unlockBodyScroll(); }
function keyNavY(e){}
function confirmYPicker(){}

/* ======== å¤šæ¬„ï¼šå€ç‡ 3 æ ¼ ======== */
const yDial = {
  overlay: document.getElementById('yDialOverlay'),
  now: document.getElementById('yDialNow'),
  btnOpen: document.getElementById('openYPicker'),
  btnCancel: document.getElementById('yDialCancel'),
  btnConfirm: document.getElementById('yDialConfirm'),
  wInt: document.getElementById('dialInt'),
  wD1: document.getElementById('dialD1'),
  wD2: document.getElementById('dialD2'),
  ITEM_H: 48,
  stopTimer: null
};
function buildWheelDial(w){ if(w.dataset.ready) return; w.innerHTML = `<div class="spacer"></div>`; for(let i=0;i<=9;i++){ const d=document.createElement('div'); d.className='digit'; d.textContent=i; w.appendChild(d); } w.insertAdjacentHTML('beforeend', `<div class="spacer"></div>`); w.dataset.ready='1';}
function clamp(v, lo, hi){ return Math.min(hi, Math.max(lo, v)); }
function setSpacerHeightsDial(w){ const spacerH = Math.max(0, (w.clientHeight - yDial.ITEM_H) / 2); const f=w.firstElementChild, l=w.lastElementChild; if(f?.classList.contains('spacer')) f.style.height = `${spacerH}px`; if(l?.classList.contains('spacer')) l.style.height = `${spacerH}px`; return spacerH;}
function currentDigitDial(w){ const h=yDial.ITEM_H, vh=w.clientHeight, sp=Math.max(0,(vh-h)/2); const center=w.scrollTop+vh/2; const idx=Math.round((center-(sp+h/2))/h); return clamp(idx,0,9);}
function snapToDigitDial(w,d,smooth=true){ const h=yDial.ITEM_H, vh=w.clientHeight, sp=Math.max(0,(vh-h)/2); const top=(sp+d*h+h/2)-(vh/2); w.scrollTo({top,behavior:smooth?'smooth':'auto'});}
function markCenterDial(w){ const idx=currentDigitDial(w); Array.from(w.querySelectorAll('.digit')).forEach((el,i)=>el.classList.toggle('center',i===idx));}
function readYValue(){ [yDial.wInt,yDial.wD1,yDial.wD2].forEach(markCenterDial); const i=currentDigitDial(yDial.wInt), a=currentDigitDial(yDial.wD1), b=currentDigitDial(yDial.wD2); let val=parseFloat(`${i}.${a}${b}`); val=clamp(val, MIN_Y, MAX_Y); yDial.now.textContent=val.toFixed(2); return val;}
function onYWheelScroll(){ readYValue(); clearTimeout(yDial.stopTimer); yDial.stopTimer=setTimeout(()=>{ const i=currentDigitDial(yDial.wInt), a=currentDigitDial(yDial.wD1), b=currentDigitDial(yDial.wD2); snapToDigitDial(yDial.wInt,i); snapToDigitDial(yDial.wD1,a); snapToDigitDial(yDial.wD2,b); setTimeout(()=>{ [yDial.wInt,yDial.wD1,yDial.wD2].forEach(markCenterDial); },160); },120);}
function setYWheelsFrom(val){ const safe=isNaN(val)?DEFAULT_Y:clamp(val, MIN_Y, MAX_Y); const i=Math.floor(safe), a=Math.floor((safe*10)%10), b=Math.floor((safe*100)%10); snapToDigitDial(yDial.wInt,i,false); snapToDigitDial(yDial.wD1,a,false); snapToDigitDial(yDial.wD2,b,false); [yDial.wInt,yDial.wD1,yDial.wD2].forEach(markCenterDial); yDial.now.textContent=safe.toFixed(2);}
function openYDial(){
  [yDial.wInt,yDial.wD1,yDial.wD2].forEach(buildWheelDial);
  yDial.overlay.style.display='flex';
  requestAnimationFrame(()=>{
    [yDial.wInt,yDial.wD1,yDial.wD2].forEach(setSpacerHeightsDial);
    const curr=parseFloat(document.getElementById('yVal').value||DEFAULT_Y);
    setYWheelsFrom(curr);
    [yDial.wInt,yDial.wD1,yDial.wD2].forEach(w=>{
      w.removeEventListener('scroll', onYWheelScroll);
      w.addEventListener('scroll', onYWheelScroll, {passive:true});
      w.addEventListener('touchend', ()=>onYWheelScroll(), {passive:true});
      w.addEventListener('mouseup',   ()=>onYWheelScroll(), {passive:true});
    });
    // å–šé†’ iOS æ…£æ€§
    [yDial.wInt,yDial.wD1,yDial.wD2].forEach(w=>wakeWheel(w));
  });
  lockBodyScroll();
}
function closeYDial(){ yDial.overlay.style.display='none'; unlockBodyScroll(); }
function confirmYDial(){ const v=readYValue(); document.getElementById('yVal').value=v.toFixed(2); closeYDial(); calc(); }

/* ======== å¤šæ¬„ï¼šå…¬é‡Œ 4 æ ¼ ======== */
const MIN_X_DIAL = 2.50, MAX_X_DIAL = 99.99;
const xDial = {
  overlay: document.getElementById('xDialOverlay'),
  now: document.getElementById('xDialNow'),
  btnOpen: document.getElementById('openXPicker'),
  btnCancel: document.getElementById('xDialCancel'),
  btnConfirm: document.getElementById('xDialConfirm'),
  wTens: document.getElementById('xDialIntTens'),
  wOnes: document.getElementById('xDialIntOnes'),
  wD1:   document.getElementById('xDialDec1'),
  wD2:   document.getElementById('xDialDec2'),
  ITEM_H: 48,
  stopTimer: null
};
function buildWheelX(w){ if(w.dataset.ready) return; w.innerHTML = `<div class="spacer"></div>`; for(let i=0;i<=9;i++){ const d=document.createElement('div'); d.className='digit'; d.textContent=i; w.appendChild(d); } w.insertAdjacentHTML('beforeend', `<div class="spacer"></div>`); w.dataset.ready='1';}
function setSpacerHeightsX(w){ const itemH=xDial.ITEM_H, viewH=w.clientHeight; const spacerH=Math.max(0,(viewH-itemH)/2); const f=w.firstElementChild, l=w.lastElementChild; if(f?.classList.contains('spacer')) f.style.height=`${spacerH}px`; if(l?.classList.contains('spacer')) l.style.height=`${spacerH}px`; return spacerH;}
function currentDigitX(w){ const h=xDial.ITEM_H, vh=w.clientHeight, sp=Math.max(0,(vh-h)/2); const center=w.scrollTop+vh/2; const idx=Math.round((center-(sp+h/2))/h); return Math.min(9, Math.max(0, idx));}
function snapToDigitX(w,d,smooth=true){ const h=xDial.ITEM_H, vh=w.clientHeight, sp=Math.max(0,(vh-h)/2); const top=(sp+d*h+h/2)-(vh/2); w.scrollTo({top,behavior:smooth?'smooth':'auto'});}
function markCenterX(w){ const idx=currentDigitX(w); Array.from(w.querySelectorAll('.digit')).forEach((el,i)=>el.classList.toggle('center', i===idx));}
function readXValue(){ [xDial.wTens,xDial.wOnes,xDial.wD1,xDial.wD2].forEach(markCenterX); const t=currentDigitX(xDial.wTens), o=currentDigitX(xDial.wOnes), a=currentDigitX(xDial.wD1), b=currentDigitX(xDial.wD2); let val=parseFloat(`${t}${o}.${a}${b}`); val=Math.min(MAX_X_DIAL, Math.max(MIN_X_DIAL, val)); xDial.now.textContent=val.toFixed(2); return val;}
function onXWheelScroll(){ readXValue(); clearTimeout(xDial.stopTimer); xDial.stopTimer=setTimeout(()=>{ const t=currentDigitX(xDial.wTens), o=currentDigitX(xDial.wOnes), a=currentDigitX(xDial.wD1), b=currentDigitX(xDial.wD2); snapToDigitX(xDial.wTens,t); snapToDigitX(xDial.wOnes,o); snapToDigitX(xDial.wD1,a); snapToDigitX(xDial.wD2,b); setTimeout(()=>{ [xDial.wTens,xDial.wOnes,xDial.wD1,xDial.wD2].forEach(markCenterX); },160); },120);}
function setXWheelsFrom(val){ const safe=isNaN(val)?MIN_X_DIAL:Math.min(MAX_X_DIAL, Math.max(0, val)); const iv=Math.floor(safe); const t=Math.floor(iv/10)%10, o=iv%10, a=Math.floor((safe*10)%10), b=Math.floor((safe*100)%10); snapToDigitX(xDial.wTens,t,false); snapToDigitX(xDial.wOnes,o,false); snapToDigitX(xDial.wD1,a,false); snapToDigitX(xDial.wD2,b,false); [xDial.wTens,xDial.wOnes,xDial.wD1,xDial.wD2].forEach(markCenterX); xDial.now.textContent=Math.min(MAX_X_DIAL, Math.max(MIN_X_DIAL, safe)).toFixed(2);}
function openXDial(){
  [xDial.wTens,xDial.wOnes,xDial.wD1,xDial.wD2].forEach(buildWheelX);
  xDial.overlay.style.display='flex';
  requestAnimationFrame(()=>{
    [xDial.wTens,xDial.wOnes,xDial.wD1,xDial.wD2].forEach(setSpacerHeightsX);
    const curr=parseFloat(document.getElementById('xVal').value||MIN_X_DIAL);
    setXWheelsFrom(curr);
    [xDial.wTens,xDial.wOnes,xDial.wD1,xDial.wD2].forEach(w=>{
      w.removeEventListener('scroll', onXWheelScroll);
      w.addEventListener('scroll', onXWheelScroll, {passive:true});
      w.addEventListener('touchend', ()=>onXWheelScroll(), {passive:true});
      w.addEventListener('mouseup',   ()=>onXWheelScroll(), {passive:true});
    });
    // å–šé†’ iOS æ…£æ€§
    [xDial.wTens,xDial.wOnes,xDial.wD1,xDial.wD2].forEach(w=>wakeWheel(w));
  });
  lockBodyScroll();
}
function closeXDial(){ xDial.overlay.style.display='none'; unlockBodyScroll(); }
function confirmXDial(){ const v=readXValue(); const finalV=Math.min(MAX_X_DIAL, Math.max(MIN_X_DIAL, v)); const input=document.getElementById('xVal'); input.value=finalV.toFixed(2); closeXDial(); calc(); }

/* ===== èƒŒæ™¯é–å®š ===== */
let bodyScrollY=0;
function lockBodyScroll(){ bodyScrollY=window.scrollY||document.documentElement.scrollTop||0; document.body.style.position='fixed'; document.body.style.top=`-${bodyScrollY}px`; document.body.style.left='0'; document.body.style.right='0'; document.body.style.width='100%'; }
function unlockBodyScroll(){ document.body.style.position=''; document.body.style.top=''; document.body.style.left=''; document.body.style.right=''; document.body.style.width=''; window.scrollTo(0, bodyScrollY); }

/* ===== é®ç½©æ‰‹å‹¢ä¿®è£œï¼šåœ¨é .wheel ä¸Šæ»‘å‹•æ™‚é˜»æ–·äº‹ä»¶éˆ ===== */
function wireDialOverlay(overlayId, closeFn){
  const ov = document.getElementById(overlayId);
  if(!ov) return;
  ov.addEventListener('touchmove', (e)=>{
    const path = e.composedPath ? e.composedPath() : [];
    const onWheel = path && path.some && path.some(node => node && node.classList && node.classList.contains('wheel'));
    if(!onWheel){ e.preventDefault(); }
  }, {passive:false, capture:true});
  ov.addEventListener('click', (e)=>{ if(e.target === ov) closeFn(); }, {passive:true});
  document.addEventListener('keydown', (e)=>{ if(ov.style.display==='flex' && e.key === 'Escape') closeFn(); });
}
wireDialOverlay('yDialOverlay', closeYDial);
wireDialOverlay('xDialOverlay', closeXDial);

/* ===== å–šé†’ iOS æ…£æ€§ï¼ˆå¶ç™¼ç¡è‘—æ™‚ï¼‰ ===== */
function wakeWheel(w){
  const prev = w.style.webkitOverflowScrolling;
  w.style.webkitOverflowScrolling = 'auto';
  void w.offsetHeight;
  w.style.webkitOverflowScrolling = prev || 'touch';
}

/* ===== æŠŠ â­¥ ç¶åˆ°ã€Œå¤šæ¬„æ»‘è¼ªã€ ===== */
try{ xPicker.btnOpen.removeEventListener('click', openXPicker); }catch(e){}
try{ yPicker.btnOpen.removeEventListener('click', openYPicker); }catch(e){}
document.getElementById('openXPicker').addEventListener('click', openXDial);
document.getElementById('xDialCancel').addEventListener('click', closeXDial);
document.getElementById('xDialConfirm').addEventListener('click', confirmXDial);
document.getElementById('openYPicker').addEventListener('click', openYDial);
document.getElementById('yDialCancel').addEventListener('click', closeYDial);
document.getElementById('yDialConfirm').addEventListener('click', confirmYDial);

/* ===== åˆå§‹ ===== */
window.addEventListener("load",function(){ resetValues(); calc(); });
</script>

<!-- === å–å–®ç‡å€å¡Šï¼ˆæœªå‹•ï¼Œä¿®æ­£ä¸€å€‹å° typoï¼‰ === -->
<div class="order-block" style="background:#1e1e1e; padding:10px; border-radius:12px;">
  <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #555; padding:8px 0;">
    <label for="completed" style="font-size:14px; color:#eee;">éå¾€è¨˜éŒ„å®Œæˆè¨‚å–®ä»¶æ•¸</label>
    <input type="number" id="completed" value=""
           style="width:60px; text-align:right; font-size:14px; background:#2a2a2a; color:#eee; border:1px solid #555; border-radius:6px; padding:4px 6px;">
  </div>
  <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #555; padding:8px 0%;">
    <label for="takeRate" style="font-size:14px; color:#eee;">å€é–“å–å–®ç‡</label>
    <div style="display:flex; align-items:center; gap:3px;">
      <input type="number" id="takeRate" value=""
             style="width:70px; text-align:right; font-size:14px; background:#2a2a2a; color:#eee; border:1px solid #555; border-radius:6px; padding:4px 6px;">
      <span style="color:#ccc; font-size:14px;">%</span>
    </div>
  </div>
  <div id="generatedOrdersResult" style="margin-top:10px; font-size:15px; font-weight:bold; text-align:center; color:#eee;"></div>
  <div id="extraInfo" style="margin-top:5px; font-size:15px; font-weight:bold; text-align:center; color:#eee;"></div>
  <div style="text-align:center; margin-top:10px;">
    <button onclick="resetOrders()" style="background:#2a2a2a; color:#eee; border:1px solid #555; padding:6px 16px; border-radius:8px; font-size:14px;">é‡ç½®</button>
  </div>
</div>

<script>
function calcOrders(){
  const completed=parseFloat(document.getElementById('completed').value);
  const takeRateInput=parseFloat(document.getElementById('takeRate').value);
  if(isNaN(completed)||isNaN(takeRateInput)||takeRateInput<=0){
    document.getElementById('generatedOrdersResult').innerText='';
    document.getElementById('extraInfo').innerText='';
    return;
  }
  const takeRate=takeRateInput/100, baseRate=0.85, generated=completed/takeRate;
  let extraText='';
  if(takeRate>=baseRate){
    const maxReject=(completed/baseRate)-generated;
    let color='#30f725'; if(maxReject<6) color='#ff4444'; else if(maxReject<11) color='#ffcc00';
    extraText=`é‚„å¯ä»¥æ‹’æ‰ <span style="color:${color}; font-weight:bold;">${maxReject.toFixed(2)}</span> å–®`;
  }else{
    const needComplete=(baseRate*generated-completed)/(1-baseRate);
    extraText=`é‚„éœ€å®Œæˆ <span style="color:#ff5555; font-weight:bold;">${needComplete.toFixed(2)}</span> å–®`;
  }
  document.getElementById('generatedOrdersResult').innerText=`ç³»çµ±ç”Ÿæˆè¨‚å–®æ•¸ï¼š${generated.toFixed(2)} å–®`;
  document.getElementById('extraInfo').innerHTML=extraText;
}
function resetOrders(){
  document.getElementById('completed').value="";
  document.getElementById('takeRate').value="";
  document.getElementById('generatedOrdersResult').innerText="";
  document.getElementById('extraInfo').innerText="";
}
</script>

<div style="text-align:center; margin-top:30px; font-size:14px; color:#fc0303; line-height:1.8; border-top:1px solid #ccc; padding-top:10px;">
  âš ï¸ æ³¨æ„äº‹é …ï¸ âš ï¸ <br>
  â€» èˆŠåˆ¶å°±æœƒå·é å–®å…¬é‡Œæ•¸0.3~0.8å…¬é‡Œä¸ç­‰ï¼Œè«‹è‡ªè¡Œå†æ‰£é™¤â€»<br>
  â€» ä»¥ä¸Šåƒ…ä¾›åƒè€ƒâ€»<br>
  2025å¹´10æœˆ21æ—¥ 19:57 <br>
</div>

<!-- ======================== -->
<!-- === è¿½åŠ æ¨£å¼ï¼ˆä¸æ”¹èˆŠï¼‰ === -->
<!-- ======================== -->
<style>
/* å–®æ¬„æ¸…å–®ï¼ˆå¯é¸ï¼‰å±¤ç´šè¦–è¦ºï¼šæƒ³è¦ä¹Ÿæœ‰ä¸­å¿ƒæ”¾å¤§æ•ˆæœå°±ä¿ç•™ï¼Œè‹¥ä¸éœ€è¦å¯åˆªæ‰é€™æ®µ */
.picker-wheel .picker-item{
  font-size: 18px;
  opacity: .35;
  transform: scale(.90);
  transition: transform .18s ease, opacity .18s ease, font-size .18s ease;
}
.picker-wheel .picker-item.near{
  font-size: 19px;
  opacity: .65;
  transform: scale(.96);
}
.picker-wheel .picker-item.far{
  font-size: 17px;
  opacity: .28;
  transform: scale(.88);
}
.picker-wheel .picker-item.center{
  font-size: 22px;
  font-weight: 800;
  opacity: 1;
  color: #fff;
  transform: scale(1.04);
}
</style>

<!-- ======================= -->
<!-- === è¿½åŠ è…³æœ¬ï¼ˆä¸æ”¹èˆŠï¼‰ === -->
<!-- ======================= -->
<script>
/* ========= è¿½åŠ ï¼šåªåšã€Œè¦–è¦ºåˆ†å±¤ã€çš„æ›´æ–°ï¼Œä¸æ”¹ä½ çš„æ²å‹•/å¸é™„é‚è¼¯ ========= */

/** è¨ˆç®— wheel è¦–è¦ºä¸­å¿ƒæœ€æ¥è¿‘å“ªå€‹ itemï¼Œä¸¦å¥— center/near/far class */
function applyCenterClasses(wheel, itemSelector){
  if(!wheel) return;
  const items = wheel.querySelectorAll(itemSelector);
  if(!items.length) return;

  const mid = wheel.scrollTop + wheel.clientHeight / 2;
  let best = 0, bestDist = Infinity;

  items.forEach((el, i) => {
    const c = el.offsetTop + el.offsetHeight / 2;
    const d = Math.abs(c - mid);
    if(d < bestDist){ bestDist = d; best = i; }
  });

  items.forEach((el, i) => {
    el.classList.remove('center','near','far');
    const dist = Math.abs(i - best);
    if(dist === 0) el.classList.add('center');
    else if(dist === 1) el.classList.add('near');
    else el.classList.add('far');
  });
}

/** ç¶å®šæŸå€‹ wheel çš„è¦–è¦ºæ›´æ–°ï¼ˆé¿å…é‡è¤‡ç¶å®šï¼šç”¨ data æ¨™è¨˜ï¼‰ */
function bindVisualUpdate(wheel, itemSelector){
  if(!wheel || wheel.dataset.visualBound) return;
  wheel.dataset.visualBound = '1';

  const update = () => applyCenterClasses(wheel, itemSelector);

  // åˆå§‹è·‘ä¸€æ¬¡ï¼ˆç­‰ä¸€å¹€ï¼Œç¢ºä¿å°ºå¯¸å®šä½OKï¼‰
  requestAnimationFrame(update);

  // æ»¾å‹•æ™‚å³æ™‚æ›´æ–°ï¼ˆç´”è¦–è¦ºã€ä¸å¡æ²å‹•ï¼‰
  wheel.addEventListener('scroll', update, { passive: true });

  // æ”¾æ‰‹ä¹Ÿè£œä¸€æ¬¡
  wheel.addEventListener('touchend', update, { passive: true });
  wheel.addEventListener('mouseup', update, { passive: true });

  // è¦–çª—å°ºå¯¸è®ŠåŒ–ï¼Œä¸­å¿ƒæœƒè®Šï¼Œè£œä¸€æ¬¡
  window.addEventListener('resize', () => requestAnimationFrame(update), { passive: true });
}

/** å•Ÿç”¨æ‰€æœ‰è¼ªå­ï¼ˆå¤šæ¬„ & å–®æ¬„ï¼‰ */
function enableAllWheelsVisual(){
  // å¤šæ¬„ï¼ˆå€ç‡ä¸‰æ¬„ï¼‰
  ['dialInt','dialD1','dialD2'].forEach(id=>{
    const w = document.getElementById(id);
    bindVisualUpdate(w, '.digit');
  });
  // å¤šæ¬„ï¼ˆå…¬é‡Œå››æ¬„ï¼‰
  ['xDialIntTens','xDialIntOnes','xDialDec1','xDialDec2'].forEach(id=>{
    const w = document.getElementById(id);
    bindVisualUpdate(w, '.digit');
  });
  // å–®æ¬„æ¸…å–®ï¼ˆå¯é¸ï¼‰
  bindVisualUpdate(document.getElementById('xPickerWheel'), '.picker-item');
  bindVisualUpdate(document.getElementById('yPickerWheel'), '.picker-item');
}

/* ---- åœ¨ã€Œé–‹å•Ÿã€æ™‚ä¿è­‰å·²å¥—ç”¨ï¼ˆåŒ…è£ä½ çš„é–‹å•Ÿå‡½å¼ï¼Œä¸æ”¹å…¶å…§å®¹ï¼‰ ---- */
(function patchOpeners(){
  // å¤šæ¬„ï¼šå€ç‡
  const _openYDial = window.openYDial;
  if (typeof _openYDial === 'function') {
    window.openYDial = function(){
      _openYDial.apply(this, arguments);
      // ç­‰ build + scrollTo å®Œæˆå¾Œå†åšä¸€æ¬¡è¦–è¦ºåˆ†å±¤
      setTimeout(() => {
        ['dialInt','dialD1','dialD2'].forEach(id=>{
          const w = document.getElementById(id);
          bindVisualUpdate(w, '.digit');
          // ç«‹å³å¥—ä¸€æ¬¡ï¼Œé¿å…å‰›é–‹å•Ÿæœƒæ²’æœ‰å±¤ç´š
          applyCenterClasses(w, '.digit');
        });
      }, 0);
    };
  }

  // å¤šæ¬„ï¼šå…¬é‡Œ
  const _openXDial = window.openXDial;
  if (typeof _openXDial === 'function') {
    window.openXDial = function(){
      _openXDial.apply(this, arguments);
      setTimeout(() => {
        ['xDialIntTens','xDialIntOnes','xDialDec1','xDialDec2'].forEach(id=>{
          const w = document.getElementById(id);
          bindVisualUpdate(w, '.digit');
          applyCenterClasses(w, '.digit');
        });
      }, 0);
    };
  }

  // å–®æ¬„ï¼ˆå¦‚æœä½ ä¹Ÿæƒ³è®“æ¸…å–®æœ‰å±¤ç´šè¦–è¦ºï¼‰
  const _openXPicker = window.openXPicker;
  if (typeof _openXPicker === 'function') {
    window.openXPicker = function(){
      _openXPicker.apply(this, arguments);
      setTimeout(() => {
        const w = document.getElementById('xPickerWheel');
        bindVisualUpdate(w, '.picker-item');
        applyCenterClasses(w, '.picker-item');
      }, 0);
    };
  }
  const _openYPicker = window.openYPicker;
  if (typeof _openYPicker === 'function') {
    window.openYPicker = function(){
      _openYPicker.apply(this, arguments);
      setTimeout(() => {
        const w = document.getElementById('yPickerWheel');
        bindVisualUpdate(w, '.picker-item');
        applyCenterClasses(w, '.picker-item');
      }, 0);
    };
  }
})();

/* é¦–æ¬¡è¼‰å…¥ä¹Ÿè·‘ä¸€æ¬¡ï¼ˆè‹¥é é¢ä¸Šè¼ªå­å·²ç¶“åœ¨ DOMï¼‰ */
document.addEventListener('DOMContentLoaded', enableAllWheelsVisual);
</script>
<script>
/* è¿½åŠ ä¿®å¾©ï¼šå¹«å–å–®ç‡å€å¡Šè£œä¸Šäº‹ä»¶ç›£è½èˆ‡åˆå§‹åŒ–ï¼ˆä¸æ”¹å‹•åŸæœ¬å‡½å¼ï¼‰ */
(function () {
  var completed = document.getElementById('completed');
  var takeRate  = document.getElementById('takeRate');

  if (completed && takeRate && typeof window.calcOrders === 'function') {
    // é¿å…é‡è¤‡ç¶å®š
    completed.removeEventListener('input', calcOrders);
    takeRate.removeEventListener('input', calcOrders);

    completed.addEventListener('input', calcOrders);
    takeRate.addEventListener('input',  calcOrders);

    // è¼‰å…¥å¾Œå…ˆè·‘ä¸€æ¬¡ï¼Œè®“ç•«é¢æœ‰å€¼å°±æ›´æ–°
    calcOrders();
  }
})();
</script>
<script>
/* === è¿½åŠ è£œä¸ï¼šæ»‘é¼ æ»¾è¼ªä¸€æ ¼å°ä¸€æ ¼ï¼ˆåªä½œç”¨æ–¼ .dial è£¡çš„æ•¸ä½æ»‘è¼ªï¼‰ === */
(function(){
  // åˆ¤æ–·æ˜¯å€ç‡(wheelå±¬æ–¼ yDial)é‚„æ˜¯å…¬é‡Œ(xDial)çš„è¼ªå­
  function isXWheel(el){ return el && /^xDial/.test(el.id); }

  // å–ç›®å‰ç´¢å¼•ï¼ˆç”¨ä½ æ—¢æœ‰çš„ currentDigitDial / currentDigitXï¼‰
  function getIdx(w){
    try { return isXWheel(w) ? currentDigitX(w) : currentDigitDial(w); }
    catch(e){ return 0; }
  }

  // å¸é™„åˆ°æŒ‡å®šç´¢å¼•ï¼ˆç”¨ä½ æ—¢æœ‰çš„ snapToDigitDial / snapToDigitXï¼‰
  function snapTo(w, idx){
    try { 
      if (isXWheel(w)) snapToDigitX(w, idx, true);
      else             snapToDigitDial(w, idx, true);
    } catch(e){}
  }

  // æ›´æ–°ä¸­å¿ƒæ¨£å¼èˆ‡è®€å€¼ï¼ˆç”¨ä½ æ—¢æœ‰çš„ markCenterX/markCenterDial + readXValue/readYValueï¼‰
  function markAndRead(w){
    try {
      if (isXWheel(w)) {
        markCenterX(w);
        // è®“ UI é¡¯ç¤ºç«‹å³åŒæ­¥
        setTimeout(()=>{ try{ readXValue(); }catch(e){} }, 0);
      } else {
        markCenterDial(w);
        setTimeout(()=>{ try{ readYValue(); }catch(e){} }, 0);
      }
    } catch(e){}
  }

  // ç¶å®šåˆ°æ‰€æœ‰ .dial .wheelï¼ˆå€ç‡3æ¬„ + å…¬é‡Œ4æ¬„ï¼‰
  var wheels = document.querySelectorAll('.dial .wheel');
  wheels.forEach(function(w){
    // å…ˆç§»é™¤å¯èƒ½æ—¢æœ‰çš„ wheel ç¶å®šï¼Œé¿å…é‡è¤‡
    w.onwheel = null;

    // ç”¨éè¢«å‹•ç›£è½ï¼Œé˜»æ­¢é è¨­æ»¾å‹•ï¼Œæ”¹æˆä¸€æ­¥ä¸€éš
    w.addEventListener('wheel', function(e){
      // åƒ…è™•ç†å‚ç›´ï¼›é˜»æ­¢é è¨­ï¼Œé¿å…ä¸€æ¬¡æ»¾å‹•è·¨å¤šé …
      e.preventDefault();

      // æ–¹å‘ï¼šå‘ä¸‹(+1)ã€å‘ä¸Š(-1)
      var dir = (e.deltaY > 0) ? 1 : -1;

      // ç›®å‰ä¸­å¿ƒç´¢å¼•
      var idx = getIdx(w);

      // æ¯æ¬¡åªè·³ä¸€æ ¼
      var next = Math.min(9, Math.max(0, idx + dir));

      // å¸é™„ + æ›´æ–°è¦–è¦º
      snapTo(w, next);
      markAndRead(w);
    }, { passive: false });
  });
})();
</script>

</body>
</html>
