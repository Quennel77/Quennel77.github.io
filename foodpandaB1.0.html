<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>å ±é…¬è¨ˆç®—</title>
<style>
/* === æ•´é«”æš—é»‘æ¨¡å¼ === */
body {
  font-family: Arial, sans-serif;
  margin: 40px;
  background: #121212;
  color: #eee;
}
/*
.container {
  max-width: 500px;
  margin: auto;
  background: #1e1e1e;
  padding: 20px;
  border-radius: 22px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}
*/
.container {
  width: 90%;
  max-width: 500px;
  margin: auto;
  background: #1e1e1e;
  padding: 20px;
  border-radius: 22px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  box-sizing: border-box;
}
h2 {
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #eee;
}
label { display: block; margin-top: 10px; font-weight: bold; color: #eee; }
.input-group { display: flex; margin: 10px 0; }
input { width: calc(100% - 50px); padding: 10px; font-size: 16px; background: #2a2a2a; color: #eee; border: 1px solid #555; border-radius: 6px; }

/* çµ±ä¸€ +ã€-ã€é‡ç½®æ¨£å¼ */
.inc-btn, .dec-btn, .reset-btn {
  width: 60px;
  height: 60px;
  font-size: 26px;
  margin-left: 5px;
  border: none;
  border-radius: 8px;
  background: #ff69b4;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.2s, background 0.2s;
}
.inc-btn:hover, .dec-btn:hover, .reset-btn:hover {
  background: #005fa3;
  transform: rotate(20deg);
}

.result { margin-top: 15px; font-size: 28px; text-align: center; font-weight: bold; }
#amount { width: 200px; font-size: 28px; text-align: center; background: #2a2a2a; border: 1px solid #555; color: #fc1212; }

#formula { margin-top: 15px; font-size: 16px; color: #eee; line-height: 1.5; white-space: pre-line; text-align: center; }
#oldFormula, #secondHint {
  margin-top: 2px;
  font-size: 15px;
  color: #ccc;
  line-height: 1.4;
  white-space: normal;
  text-align: center;
}
#errorMsg { color:red; margin-bottom:10px; font-weight:bold; }

/* âœ… å–®ç¨æ§åˆ¶ç–Šå–®é‚£æ’å¤§å°ï¼Œä¸å½±éŸ¿ä¸Šæ–¹ä¸»é‡‘é¡ */
.sub-result {
  font-size: 16px !important;   /* ç–Šå–®èˆ‡å…ƒè®Šå° */
}

.sub-result #secondAmount {
  width: 70px !important;
  font-size: 18px !important;
  padding: 2px 4px !important;
}

body, button {
  touch-action: manipulation;
  -webkit-user-select: none;
  -webkit-tap-highlight-color: transparent;
}

input {
  touch-action: auto;
  -webkit-user-select: text;
}

/* éš±è—æ•¸å­—è¼¸å…¥æ¡†çš„ä¸Šä¸‹ç®­é ­ */
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
input[type=number] { -moz-appearance: textfield; }

/* å–æ¶ˆæŒ‰éˆ•æŒ‰ä¸‹å‹•ç•« */
button, .calc-btn, .reset-btn { transition: none !é‡è¦; transform: none !important; }
button:active, .calc-btn:active, .reset-btn:active { transform: none !important; scale: 1 !important; }

/* å–å–®ç‡å€å¡ŠèƒŒæ™¯æš—é»‘åŒ– */
.order-block { max-width:300px; margin:20px auto; font-size:16px; font-family:Arial, sans-serif; color:#eee; }
.order-block input { background:#2a2a2a; color:#eee; border:1px solid #555; }
.order-block span { color:#ccc; }
.order-block button { background:#0078d7; color:#fff; }

#base25 {
  font-size: 15px;
  color: #ccc;
  margin-top: 4px;
  text-align: center;
}

#extraFee {
  font-size: 15px;
  color: #ccc;
  margin-top: 4px;
  text-align: center;
}

#base25secondHint {
  font-size: 15px;
  color: #ccc;
  margin-top: 4px;
  text-align: center;
}

#extraFeesecondHint {
  font-size: 15px;
  color: #ccc;
  margin-top: 4px;
  text-align: center;
}

/* å°è¢å¹• */
@media (max-width: 375px) {
  .inc-btn, .dec-btn, .reset-btn {
    width: 50px;
    height: 50px;
    font-size: 20px;
  }
  #amount {
    font-size: 32px;
    width: 150px;
  }
  #formula, #oldFormula, #secondHint {
    font-size: 14px;
  }
}
</style>
</head>

<body>
<div class="container">
  <h2>
    å ±é…¬è¨ˆç®—
    <button class="reset-btn" onclick="resetValues()">ğŸ”„</button>
  </h2>

  <label>ç•¶æ™‚å€ç‡ï¼š</label>
  <div class="input-group">
    <input type="number" id="yVal" value="1.40" step="0.10" oninput="calc()">
    <button class="inc-btn" onclick="change('yVal', 0.10)">+</button>
    <button class="dec-btn" onclick="change('yVal', -0.10)">-</button>
  </div>
  
  <label>ç¸½å…¬é‡Œæ•¸ï¼š</label>
  <div class="input-group">
    <input type="number" id="xVal" value="2.50" step="0.10" oninput="calc()">
    <button class="inc-btn" onclick="change('xVal', 0.10)">+</button>
    <button class="dec-btn" onclick="change('xVal', -0.10)">-</button>
  </div>

<!-- ğŸš€ æ”¹ç‰ˆï¼šéš±è—å…¬é‡ŒåŠ æˆè¼¸å…¥æ¡†ï¼Œä½†ä¿ç•™ä»£ç¢¼ -->
<!--
<label>å…¬é‡ŒåŠ æˆï¼š</label>
<div class="input-group">
  <input type="number" id="kmFee" value="11.50" step="0.10" oninput="calc()">
</div>
-->

  <div id="errorMsg"></div>

  <div class="result">
    <input type="number" id="amount" value="" step="0.01" placeholder="è¼¸å…¥é‡‘é¡" /> å…ƒ
    <div id="base25"></div>
    <div id="extraFee"></div>
    <div id="secondHint"></div>
    <div class="sub-result">
      <span class="second-text">ç–Šå–®ï¼š</span>
      <input type="number" id="secondAmount" value="" step="0.01" 
        style="width:90px; font-size:18px; text-align:center; background:#2a2a2a; color:#eee; border:1px solid #555; border-radius:6px;"> å…ƒ
    </div>
    <div id="base25secondHint"></div>
    <div id="extraFeesecondHint"></div>
    <div id="oldFormula"></div>
  </div>
</div>

<script>
// const kmFeeInput = document.getElementById('kmFee'); // â† ä¸å†æŠ“å–è¼¸å…¥æ¡†
const DEFAULT_X = 2.50;   // é è¨­å…¬é‡Œæ•¸
const DEFAULT_Y = 1.40;   // é è¨­å€ç‡
const SECOND_FLOOR = 30;  // ç–Šå–®æœ€ä½åƒ¹
let KM_FEE = 12.142;      // ğŸ§­ å…¨åŸŸå…¬é‡ŒåŠ æˆï¼Œå¯è‡ªç”±èª¿æ•´æ¸¬è©¦

function change(id, delta) {
  const input = document.getElementById(id);
  let value = parseFloat(input.value) || 0;

  // é™åˆ¶å…¬é‡Œæ•¸æœ€ä½ç‚º 2.50
  if (id === "xVal") {
    value += delta;
    if (value < 2.50) value = 2.50;
  } else {
    value += delta;
    if (value < 0) value = 0;
  }

  input.value = value.toFixed(2);
  calc();
}

function showError(msg) {
  document.getElementById('errorMsg').innerText = msg || '';
}

function calc() {
  const x = parseFloat(document.getElementById('xVal').value);
  const y = parseFloat(document.getElementById('yVal').value);
  const amountInput = document.getElementById('amount');

  if (isNaN(x) || isNaN(y)) { showError(''); return; } else { showError(''); }

  // === æ–°ç®—æ³• ===
  const baseFirst = (10 + 10 + 5 + 5) * y;                    // ç¬¬ä¸€å–®å›ºå®šéƒ¨åˆ†
  const distancePart = Math.max(0, (x - 2.50)) * KM_FEE * y;  // è·é›¢åŠ æˆï¼ˆå…©è€…å…±ç”¨ï¼‰

  // ç¬¬ä¸€å–®
  const first = baseFirst + distancePart;

  // â–¶ ç–Šå–®ï¼ˆ2.5 å…¬é‡Œå…§ï¼šã€Œmax(30, 20*y)ã€ï¼Œè¶…éè·é›¢å†åŠ è·é›¢è²»ï¼‰
  const baseSecondRaw = (10 + 5 + 5) * y;                     // 20 * y
  const baseSecond25 = Math.max(SECOND_FLOOR, baseSecondRaw); // ä½æ–¼30æ™‚é¡¯ç¤º30ï¼Œå¦å‰‡é¡¯ç¤º 20*y
  const distanceSecondFee = distancePart;                     // ç–Šå–®è·é›¢åŠ æˆåŒä¸Š
  const second = baseSecond25 + distanceSecondFee;            // (max(30,20y)) + è·é›¢åŠ æˆ

  // é¡¯ç¤ºç¬¬ä¸€å–®é‡‘é¡ï¼ˆè‹¥ä¸æ˜¯åœ¨æ‰‹å‹•æ”¹ç¬¬ä¸€å–®é‡‘é¡ï¼‰
  if (!(document.activeElement && document.activeElement.id === 'amount')) {
    amountInput.value = first.toFixed(2);
  }

  // æ–‡å­—é¡¯ç¤º
  const base25 = (10 + 10 + 5 + 5) * y;                       // 2.5 å…¬é‡Œå…§ç¬¬ä¸€å–®é‡‘é¡
  const distanceFee = distancePart;                           // å¤šå‡ºé‡Œç¨‹è²»ç”¨
  document.getElementById('base25').innerText = `ç›®å‰å–®åƒ¹ï¼š ${base25.toFixed(2)} å…ƒ`;
  document.getElementById('extraFee').innerText = `å¤šå‡ºé‡Œç¨‹è²»ç”¨ï¼š ${distanceFee.toFixed(2)} å…ƒ`;

  // ç–Šå–®é‡‘é¡æ›´æ–°è¼¸å…¥æ¡†ï¼ˆè‹¥ä¸æ˜¯åœ¨æ‰‹å‹•æ”¹ç–Šå–®é‡‘é¡ï¼‰
  const secondInput = document.getElementById('secondAmount');
  const activeId = document.activeElement ? document.activeElement.id : "";
  if (activeId !== 'secondAmount') {
    secondInput.value = second.toFixed(2);
  }
  document.getElementById('base25secondHint').innerText = `ç›®å‰ç–Šå–®å–®åƒ¹ï¼š ${baseSecond25.toFixed(2)} å…ƒ`;
  document.getElementById('extraFeesecondHint').innerText = `å¤šå‡ºç–Šå–®é‡Œç¨‹è²»ç”¨ï¼š ${distanceSecondFee.toFixed(2)} å…ƒ`;

  // èˆŠåˆ¶åƒè€ƒ
  const oldResultRush = (40 + ((x - 2.5) * 15) + 2).toFixed(2);
  const diffRush = (first - oldResultRush).toFixed(2);
  document.getElementById('oldFormula').innerHTML =
    `èˆŠåˆ¶ç®—æ³•ï¼šé¤æœŸ 40+2 + ${(x - 2.5).toFixed(2)}Ã—15 = <span style="color:#fa6969; font-weight:bold;">${oldResultRush} å…ƒ</span><br>(å·® ${diffRush} å…ƒ)`;
}

document.getElementById('amount').addEventListener('input', function() {
  const price = parseFloat(this.value);
  const y = parseFloat(document.getElementById('yVal').value);
  const xInput = document.getElementById('xVal');

  if (this.value === '') { showError(''); return; }
  if (isNaN(price) || isNaN(y) || y === 0) { showError(''); return; }

  // é‡‘é¡åæ¨å…¬é‡Œæ•¸ï¼ˆç¬¬ä¸€å–®å…¬å¼ï¼‰
  const fixedPart = (10 + 10 + 5 + 5) * y;
  const x = ((price - fixedPart) / (KM_FEE * y)) + 2.5;

  if (!isFinite(x)) return;
  if (x < 2.50) return;

  xInput.value = x.toFixed(2);
  calc();
});

// ç–Šå–®é‡‘é¡åæ¨å…¬é‡Œæ•¸
document.getElementById('secondAmount').addEventListener('input', function() {
  const price = parseFloat(this.value);
  const y = parseFloat(document.getElementById('yVal').value);
  const xInput = document.getElementById('xVal');
  const base = Math.max(30, (10 + 5 + 5) * y); // = max(30, 20*y)

  if (this.value === '' || isNaN(price) || isNaN(y) || y === 0) return;

  // ç–Šå–®åæ¨å…¬é‡Œæ•¸å…¬å¼
  const x = ((price - base) / (KM_FEE * y)) + 2.5;
  if (!isFinite(x) || x < 2.5) return;

  xInput.value = x.toFixed(2);
  calc();
});

function resetValues() {
  document.getElementById('xVal').value = DEFAULT_X.toFixed(2);
  document.getElementById('yVal').value = DEFAULT_Y.toFixed(2);
  calc();
}

window.onload = function() { resetValues(); };
</script>

<!-- === éå¾€è¨˜éŒ„å€å¡Šï¼ˆé»‘æš—åŒ–ï¼‰ === -->
<div class="order-block" style="background:#1e1e1e; padding:10px; border-radius:12px;">
  <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #555; padding:8px 0;">
    <label for="completed" style="font-size:14px; color:#eee;">éå¾€è¨˜éŒ„å®Œæˆè¨‚å–®ä»¶æ•¸</label>
    <input type="number" id="completed" value=""
           style="width:60px; text-align:right; font-size:14px; background:#2a2a2a; color:#eee; border:1px solid #555; border-radius:6px; padding:4px 6px;">
  </div>

  <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #555; padding:8px 0;">
    <label for="takeRate" style="font-size:14px; color:#eee;">å€é–“å–å–®ç‡</label>
    <div style="display:flex; align-items:center; gap:3px;">
      <input type="number" id="takeRate" value=""
             style="width:70px; text-align:right; font-size:14px; background:#2a2a2a; color:#eee; border:1px solid #555; border-radius:6px; padding:4px 6px;">
      <span style="color:#ccc; font-size:14px;">%</span>
    </div>
  </div>

  <div id="generatedOrdersResult" style="margin-top:10px; font-size:15px; font-weight:bold; text-align:center; color:#eee;"></div>
  <div id="extraInfo" style="margin-top:5px; font-size:15px; font-weight:bold; text-align:center; color:#eee;"></div>

  <div style="text-align:center; margin-top:10px;">
    <button onclick="resetOrders()"
            style="background:#2a2a2a; color:#eee; border:1px solid #555; padding:6px 16px; border-radius:8px; font-size:14px;">
      é‡ç½®
    </button>
  </div>
</div>

<script>
function calcOrders() {
  const completed = parseFloat(document.getElementById('completed').value);
  const takeRateInput = parseFloat(document.getElementById('takeRate').value);

  if (isNaN(completed) || isNaN(takeRateInput) || takeRateInput <= 0) {
    document.getElementById('generatedOrdersResult').innerText = '';
    document.getElementById('extraInfo').innerText = '';
    return;
  }

  const takeRate = takeRateInput / 100;
  const baseRate = 0.85;
  const generated = completed / takeRate;

  let extraText = '';
  if (takeRate >= baseRate) {
    const maxReject = (completed / baseRate) - generated;
    extraText = `é‚„å¯ä»¥æ‹’æ‰ ${maxReject.toFixed(2)} å–®`;
  } else {
    const needComplete = (baseRate * generated - completed) / (1 - baseRate);
    extraText = `é‚„éœ€è¦å®Œæˆ ${needComplete.toFixed(2)} å–®`;
  }

  document.getElementById('generatedOrdersResult').innerText =
    `ç³»çµ±ç”Ÿæˆè¨‚å–®æ•¸ï¼š${generated.toFixed(2)} å–®`;
  document.getElementById('extraInfo').innerText = extraText;
}

function resetOrders() {
  document.getElementById('completed').value = "";
  document.getElementById('takeRate').value = "";
  document.getElementById('generatedOrdersResult').innerText = "";
  document.getElementById('extraInfo').innerText = "";
}

document.getElementById('completed').addEventListener('input', calcOrders);
document.getElementById('takeRate').addEventListener('input', calcOrders);

window.addEventListener("load", function() {
  resetValues();      // é‡ç½®å€ç‡èˆ‡å…¬é‡Œæ•¸
  resetOrders();      // é‡ç½®å–å–®ç‡å€
  calc();             // ç¢ºä¿å…¬å¼å€æœ‰æ›´æ–°
});
</script>

<div style="text-align:center; margin-top:30px; font-size:14px; color:#fc0303; line-height:1.8; border-top:1px solid #ccc; padding-top:10px;">
  âš ï¸ æ³¨æ„äº‹é …ï¸ âš ï¸ <br>
  â€» èˆŠåˆ¶å°±æœƒå·é å–®å…¬é‡Œæ•¸0.3~0.8å…¬é‡Œä¸ç­‰ï¼Œè«‹è‡ªè¡Œå†æ‰£é™¤â€»<br>
  â€» ä»¥ä¸Šåƒ…ä¾›åƒè€ƒâ€»<br>
  2025å¹´10æœˆ20æ—¥ 04:41 v1.2<br>
</div>
</body>
</html>
